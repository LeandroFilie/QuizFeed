<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="./assets/favicon.png" type="image/png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./style/main.css">
    <link rel="stylesheet" href="./style/cadastro.css">
    <link rel="stylesheet" href="./style/menu_mobile.css">
    <title>Cadastro | TesteFeed</title>
    <script src="./js/jquery-3.6.0.min.js"></script>
    <script src="./js/main.js"></script>
    <script src='js/moment.js'></script>
    <script src='js/md5.js'></script>
</head>
<body>
    <header>
        <nav>
            <div><a href="index.html"><img src="./assets/logo.svg" alt="logo" class="logo"></a></div>
            <button id="js-open-menu" class="menu-button">
                <i class="menu-icon"></i>
            </button>
            <ul class="menu">
                <li><a href="index.html">Home</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <div class="register-title">
            <h3>Crie sua Conta</h3>
        </div>
        <div class="form">
            <input type="text" name="nome_completo" id="nome_completo" placeholder="Nome Completo" required />
            <input type="text" name="nome_usuario" id="nome_usuario" placeholder="Nome de Usuário" required />
            <div id="erro_nome"></div>
            <input type="email" name="email" id="email" placeholder="E-mail" required />
            <div id="erro_email"></div>
            <div id="campo_senha" class="campo_senha">
                <input type="password" name="senha" id="senha" placeholder="Senha" required />
                <img src="./assets/eye.svg" alt="" id="mostrar_senha" class="button_mostrar_senha">
            </div>
            <div id="campo_confirma_senha" class="campo_senha">
                <input type="password" name="confirma_senha" id="confirma_senha" placeholder="Confirme a Senha" required />
                <img src="./assets/eye.svg" alt="" id="mostrar_confirma_senha" class="button_mostrar_senha">
            </div>
                <div id="erro_senha"></div>
            <button id="cadastro_usuario" class="register-btn">Cadastrar</button>
        </div>
    </main>

    <footer>
        <span> Site desenvolvido por: Carol, Julia Costa e Leandro</span>
    </footer>

    <script>
        $(document).ready(function(){
            $("#cadastro_usuario").click(function(){
                var nome_completo = $("#nome_completo").val();
                var nome_usuario = $("#nome_usuario").val();
                var email = $("#email").val();
                var senha = $("#senha").val();
                var confirma_senha = $("#confirma_senha").val();

                if((nome_usuario === '') || (nome_completo === '') || (email === '') || (senha === '')){
                    alert("Preencha todos os campos");
                }
                else{
                    if(senha === confirma_senha){
                        var senha = $.md5(senha);
                        $.post("insere_usuario.php",{"nome_completo":nome_completo,"nome_usuario":nome_usuario, "email":email,"senha":senha},function(r){

                            limparMensagensErro();

                            if(r == 0){
                                location.href="home.php";
                            }
                            else if(r == 1){
                                mensagemErroEmail();
                            }
                            else if(r == 2){
                                mensagemErroNomeUsuario();
                            }
                            else if(r == 3){
                                mensagemErroEmail();
                                mensagemErroNomeUsuario();
                            }
                        });
                    }
                    else{
                        $("#erro_senha").addClass("erro_senha");
                        $("#erro_senha").html("As senhas não conferem");
                    }
                }
            });

            function limparMensagensErro(){
                $("#erro_senha").removeClass("erro_senha");
                $("#erro_senha").html("");
                
                $("#erro_email").removeClass("erro_email");
                $("#erro_email").html("");

                $("#erro_nome").removeClass("erro_nome");
                $("#erro_nome").html("");
            }

            function mensagemErroEmail(){
                $("#erro_email").addClass("erro_email");
                $("#erro_email").html("E-mail já cadastrado");
            }

            function mensagemErroNomeUsuario(){
                $("#erro_nome").addClass("erro_nome");
                $("#erro_nome").html("Nome de Usuário já existe");
            }

            $('#mostrar_senha').click(function(){
                if($('#senha').attr('type') == 'password'){
                    $('#senha').attr('type', 'text');
                    $('#mostrar_senha').attr('src', './assets/eye-off.svg');
                }
                else{
                    $('#senha').attr('type', 'password');
                    $('#mostrar_senha').attr('src', './assets/eye.svg');
                }
            });

            $('#mostrar_confirma_senha').click(function(){
                if($('#confirma_senha').attr('type') == 'password'){
                    $('#confirma_senha').attr('type', 'text');
                    $('#mostrar_confirma_senha').attr('src', './assets/eye-off.svg');
                }
                else{
                    $('#confirma_senha').attr('type', 'password');
                    $('#mostrar_confirma_senha').attr('src', './assets/eye.svg');
                }
            });

            
        });

            

    </script>
</body>
</html>